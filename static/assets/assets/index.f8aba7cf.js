import{d as e,r as t,e as a,aJ as l,A as o,B as i,aG as d,aF as s,aL as n,E as r,aI as c,aT as u,aU as _,b7 as m,bP as k,bR as p,bQ as f,bN as b,aR as y,b1 as v,b0 as x,b6 as h,aW as w,bI as g,bJ as j}from"./arco.6fa229d2.js";import{o as C,_ as U}from"./index.83788e4d.js";/* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css                *//* empty css              *//* empty css                *//* empty css               *//* empty css                *//* empty css               */import{h as V}from"./moment.9709ab41.js";import"./chart.f78d3971.js";import"./vue.17197c5c.js";const I={key:0},R={key:1},L=e({__name:"table-data",setup(e){const U={current:1,pageSize:20},L=t({tickets_key_count:null,tickets_key_points:null,tickets_key_prefix:"",tickets_key_remarks:""}),D=t({fc:"",state:"",data:""}),Y=t({id:0}),A=[{title:"ID",dataIndex:"ID"},{title:"卡密值",dataIndex:"tickets_key"},{title:"点券数",dataIndex:"tickets_key_points"},{title:"卡密备注",dataIndex:"tickets_key_remarks"},{title:"卡密状态",dataIndex:"tickets_key_state",slotName:"tickets_key_state"},{title:"生成时间",dataIndex:"CreatedAt"},{title:"操作",slotName:"optional"}],O=t({table:[]}),B=a(!1),E=a(!1),H=async e=>{var t;await(t=e,C.get(`/v3/api/tickets/division/data?page=${t}`)).then((e=>{U.current=e.data.page,O.table=e.data.page_data,O.table.forEach((e=>{e.CreatedAt=V(e.CreatedAt).format("YYYY-MM-DD HH:mm:ss")}))}))};H(U.current);const M=()=>{B.value=!0},$=()=>{L.tickets_key_count?L.tickets_key_points?(function(e){return C.post("/v3/api/tickets/add",e)}(L).then((e=>{2e3===e.code&&(H(1),u.success("添加成功"),C.get("/v3/api/tickets/data/download",{isDownload:!0}).then((e=>{!function(e,t,a,l){var o=new Blob(void 0!==l?[l,e]:[e],{type:a||"application/octet-stream"});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(o,t);else{var i=window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(o):window.webkitURL.createObjectURL(o),d=document.createElement("a");d.style.display="none",d.href=i,d.setAttribute("download",t),void 0===d.download&&d.setAttribute("target","_blank"),document.body.appendChild(d),d.click(),setTimeout((function(){document.body.removeChild(d),window.URL.revokeObjectURL(i)}),200)}}(e,"CD-KEY.txt")})))})),B.value=!1):u.error("卡密余额不能为空"):u.error("卡密数量不能为空")},N=()=>{B.value=!1},S=e=>{D.fc=e},T=e=>{D.state=e},J=()=>{E.value=!0},z=()=>{D.fc?D.data?(function(e){return C.get(`/v3/api/tickets/search?type=${e.fc}&state=${e.state}&s=${e.data}`)}(D).then((e=>{2e3===e.code&&(u.success("检索成功"),D.data="",O.table=e.data,O.table.forEach((e=>{e.CreatedAt=V(e.CreatedAt).format("YYYY-MM-DD HH:mm:ss")})))})),U.current=1,E.value=!1):u.error("检索值不能为空"):u.error("检索方法不能为空")},F=()=>{E.value=!1},G=()=>{H(1)},K=e=>{Y.id=e,function(e){return C.delete("/v3/api/tickets/delete",{data:e})}(Y).then((e=>{2e3===e.code&&(u.success("删除成功"),H(U.current))}))};return(e,t)=>{const a=l("icon-plus"),u=_,C=l("icon-search"),V=l("icon-refresh"),Y=m,P=k,Q=l("icon-delete"),W=p,q=f,X=b,Z=y,ee=v,te=x,ae=h,le=w,oe=g,ie=j;return o(),i(c,null,[d(u,{type:"outline",onClick:M},{icon:s((()=>[d(a)])),default:s((()=>[n("添加")])),_:1}),n("   "),d(u,{type:"outline",onClick:J},{icon:s((()=>[d(C)])),default:s((()=>[n("搜索")])),_:1}),n("   "),d(u,{type:"outline",status:"success",onClick:G},{icon:s((()=>[d(V)])),default:s((()=>[n("重置")])),_:1}),d(Y),d(q,{pagination:!1,columns:A,data:O.table},{tickets_key_state:s((({record:e})=>[!0===e.tickets_key_state?(o(),i("span",I,[d(P,{bordered:"",color:"green"},{default:s((()=>[n("未使用")])),_:1})])):(o(),i("span",R,[d(P,{bordered:"",color:"red"},{default:s((()=>[n("已使用")])),_:1})]))])),optional:s((({record:e})=>[d(W,{content:"确认删除卡密？",onOk:t=>K(e.ID)},{default:s((()=>[d(u,{type:"text",status:"danger"},{icon:s((()=>[d(Q)])),default:s((()=>[n("删除")])),_:1})])),_:2},1032,["onOk"])])),_:1},8,["data"]),d(X,{style:{float:"right","margin-top":"10px","margin-right":"20px","margin-bottom":"10px"},total:10*U.current,simple:"",onChange:H},null,8,["total"]),d(le,{width:500,visible:B.value,"unmount-on-close":"","ok-text":"添加卡密",onOk:$,onCancel:N},{title:s((()=>[n(" 卡密新增 ")])),default:s((()=>[r("div",null,[d(ae,{model:L,layout:"vertical"},{default:s((()=>[d(ee,{field:"tickets_key_count",label:"添加数量"},{default:s((()=>[d(Z,{modelValue:L.tickets_key_count,"onUpdate:modelValue":t[0]||(t[0]=e=>L.tickets_key_count=e)},null,8,["modelValue"])])),_:1}),d(ee,{field:"tickets_key_points",label:"卡密点券"},{default:s((()=>[d(Z,{modelValue:L.tickets_key_points,"onUpdate:modelValue":t[1]||(t[1]=e=>L.tickets_key_points=e)},null,8,["modelValue"])])),_:1}),d(ee,{field:"tickets_key_prefix",label:"卡密前缀"},{default:s((()=>[d(te,{modelValue:L.tickets_key_prefix,"onUpdate:modelValue":t[2]||(t[2]=e=>L.tickets_key_prefix=e)},null,8,["modelValue"])])),_:1}),d(ee,{field:"tickets_key_remarks",label:"卡密备注"},{default:s((()=>[d(te,{modelValue:L.tickets_key_remarks,"onUpdate:modelValue":t[3]||(t[3]=e=>L.tickets_key_remarks=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["visible"]),d(le,{width:500,visible:E.value,"unmount-on-close":"","ok-text":"检索",onOk:z,onCancel:F},{title:s((()=>[n(" 卡密筛选 ")])),default:s((()=>[r("div",null,[d(ae,{model:D,layout:"vertical"},{default:s((()=>[d(ee,{field:"email",label:"检索内容"},{default:s((()=>[d(ie,{placeholder:"选择检索项",onChange:S},{default:s((()=>[d(oe,null,{default:s((()=>[n("卡密值")])),_:1}),d(oe,null,{default:s((()=>[n("卡密备注")])),_:1})])),_:1})])),_:1}),d(ee,{field:"email",label:"检索状态"},{default:s((()=>[d(ie,{placeholder:"选择检索项",onChange:T},{default:s((()=>[d(oe,null,{default:s((()=>[n("全部")])),_:1}),d(oe,null,{default:s((()=>[n("未使用")])),_:1}),d(oe,null,{default:s((()=>[n("已使用")])),_:1})])),_:1})])),_:1}),d(ee,{field:"points",label:"欲检索内容"},{default:s((()=>[d(te,{modelValue:D.data,"onUpdate:modelValue":t[4]||(t[4]=e=>D.data=e),placeholder:"值（支持模糊搜索）"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["visible"])],64)}}}),D={class:"container"},Y={class:"left-side",style:{"margin-top":"12px"}},A={class:"panel"},O=U(e({name:"Task",setup:e=>(e,t)=>{const a=l("Breadcrumb");return o(),i("div",D,[d(a,{items:["卡密管理"]}),r("div",Y,[r("div",A,[d(L)])])])}}),[["__scopeId","data-v-a3e2c53f"]]);export{O as default};
